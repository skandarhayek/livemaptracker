<!DOCTYPE html>
<html>
  <head>
    <title>CDT Live Tracker</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
      #map {
        height: 100vh;
        width: 100vw;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <script src="https://unpkg.com/leaflet-omnivore/leaflet-omnivore.min.js"></script>

    <script>
      const map = L.map("map").setView([39, -106.5], 6); // Central Rockies

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "&copy; OpenStreetMap contributors"
      }).addTo(map);

      fetch("history.json")
        .then((res) => res.json())
        .then((history) => {
          history.forEach((point) => {
            console.log(point);
            const coords = point.geometry.coordinates;
            const props = point.properties;

            const latlng = [coords[1], coords[0]];
            const date = new Date(props["timestamp"]);
            const popupContent = `
              <b>${props["name"] || "Track Point"}</b><br>
              <b>Time:</b> ${date.toLocaleDateString()} ${date.toLocaleTimeString()}<br>
              <b>Latitude:</b> ${latlng[0].toFixed(6)}<br>
              <b>Longitude:</b> ${latlng[1].toFixed(6)}<br>
              <b>Elevation:</b> ${props["elevation"] || "N/A"}<br>
              <b>Velocity:</b> ${props["velocity"] || "N/A"}
            `;

            L.marker(latlng).addTo(map).bindPopup(popupContent);
          });

          const polyline = history.map((f) => [
            f.geometry.coordinates[1],
            f.geometry.coordinates[0]
          ]);
          L.polyline(polyline, { color: "blue" }).addTo(map);
        });
    </script>
  </body>
</html>
